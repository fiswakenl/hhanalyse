#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
"""
import pandas as pd
import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –¥–∞—à–±–æ—Ä–¥–∞
from interactive_dashboard import filter_data, SALARY_MIN, SALARY_MAX, df

def test_filter_fix():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö"""
    
    print("=== –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ HR Analytics –¥–∞—à–±–æ—Ä–¥–∞ ===\n")
    
    # –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    print(f"–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ: {len(df)}")
    
    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π —Å –∑–∞—Ä–ø–ª–∞—Ç–∞–º–∏
    with_salary = df['salary_from_rub'].notna().sum()
    without_salary = len(df) - with_salary
    print(f"–ó–∞–ø–∏—Å–∏ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π: {with_salary}")
    print(f"–ó–∞–ø–∏—Å–∏ –±–µ–∑ –∑–∞—Ä–ø–ª–∞—Ç—ã: {without_salary}")
    
    print(f"\n–î–∏–∞–ø–∞–∑–æ–Ω –∑–∞—Ä–ø–ª–∞—Ç: {SALARY_MIN} - {SALARY_MAX}")
    
    # –¢–µ—Å—Ç 1: –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ 743)
    print("\n--- –¢–µ—Å—Ç 1: –ë–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ ---")
    filtered_no_filters = filter_data("all", "all", "all", [SALARY_MIN, SALARY_MAX])
    print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤: {len(filtered_no_filters)} –∑–∞–ø–∏—Å–µ–π")
    
    if len(filtered_no_filters) == len(df):
        print("‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û! –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–∏—Å–∏ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤")
    else:
        print("‚ùå –ü–†–û–ë–õ–ï–ú–ê: –í—Å–µ –µ—â–µ —Ç–µ—Ä—è—é—Ç—Å—è –∑–∞–ø–∏—Å–∏")
    
    # –¢–µ—Å—Ç 2: –° —Ñ–∏–ª—å—Ç—Ä–æ–º –∑–∞—Ä–ø–ª–∞—Ç (–¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–∏ —Å –∑–∞—Ä–ø–ª–∞—Ç–æ–π)
    print("\n--- –¢–µ—Å—Ç 2: –° —Ñ–∏–ª—å—Ç—Ä–æ–º –∑–∞—Ä–ø–ª–∞—Ç ---")
    filtered_with_salary = filter_data("all", "all", "all", [50000, 200000])
    print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –∑–∞—Ä–ø–ª–∞—Ç 50k-200k: {len(filtered_with_salary)} –∑–∞–ø–∏—Å–µ–π")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏–º–µ—é—Ç –∑–∞—Ä–ø–ª–∞—Ç—É –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
    valid_salary_filter = (
        (filtered_with_salary['salary_from_rub'].notna()) &
        (filtered_with_salary['salary_from_rub'] >= 50000) &
        (filtered_with_salary['salary_from_rub'] <= 200000)
    ).all()
    
    if valid_salary_filter:
        print("‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    else:
        print("‚ùå –ü–†–û–ë–õ–ï–ú–ê: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    
    # –¢–µ—Å—Ç 3: –° –¥—Ä—É–≥–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–∞—Ä–ø–ª–∞—Ç
    print("\n--- –¢–µ—Å—Ç 3: –§–∏–ª—å—Ç—Ä –ø–æ –æ–ø—ã—Ç—É –±–µ–∑ –∑–∞—Ä–ø–ª–∞—Ç ---")
    experience_options = df['experience_name'].dropna().unique()
    if len(experience_options) > 0:
        test_experience = experience_options[0]
        filtered_experience = filter_data("all", "all", test_experience, [SALARY_MIN, SALARY_MAX])
        expected_count = len(df[df['experience_name'] == test_experience])
        print(f"–§–∏–ª—å—Ç—Ä –ø–æ –æ–ø—ã—Ç—É '{test_experience}': {len(filtered_experience)} –∏–∑ {expected_count} –æ–∂–∏–¥–∞–µ–º—ã—Ö")
        
        if len(filtered_experience) == expected_count:
            print("‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –æ–ø—ã—Ç—É —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
        else:
            print("‚ùå –ü–†–û–ë–õ–ï–ú–ê: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –æ–ø—ã—Ç—É —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    
    print("\n=== –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ===")
    print(f"–ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: 225 –∏–∑ 743 –∑–∞–ø–∏—Å–µ–π")
    print(f"–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: {len(filtered_no_filters)} –∏–∑ {len(df)} –∑–∞–ø–∏—Å–µ–π")
    
    if len(filtered_no_filters) == len(df):
        print("üéâ –ü–†–û–ë–õ–ï–ú–ê –ò–°–ü–†–ê–í–õ–ï–ù–ê! –¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.")
    else:
        print("‚ö†Ô∏è  –ü—Ä–æ–±–ª–µ–º–∞ —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–µ–Ω–∞, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.")

if __name__ == "__main__":
    test_filter_fix()